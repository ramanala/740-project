\begin{lstlisting}[float=t, caption = {\textbf{Annotated Update Protocol.}
\textit{\footnotesize The
listing shows an example update protocol. The micro-operations generated for each
system call are shown along with their dependencies. The inode number of \smalltt{x2VC} 
is 12. The inode number of the root directory is 2. Some details of listed system
calls have been elided for brevity.
}}, label = {lst-micro-example}, escapechar=!]

!\vspace{-0.4in}!

open(path="/x2VC") = 10
!{\fontfamily{Times}\selectfont Micro-operations: None!
!{\fontfamily{Times}\selectfont Dependencies: None!

!\vspace{-0.2in}!
pwrite(fd=10, offset=0, size=1024)
!{\fontfamily{Times}\selectfont Micro-operations:!
!{\fontfamily{Times}\selectfont \#1 write\_block(inode=12, offset=0, size=512)}! 
!{\fontfamily{Times}\selectfont \#2 write\_block(inode=12, offset=512, size=512)}! 
!{\fontfamily{Times}\selectfont Dependencies: None!

!\vspace{-0.2in}!
fsync(10)
!{\fontfamily{Times}\selectfont Micro-operations: None!
!{\fontfamily{Times}\selectfont Dependencies: None!

!\vspace{-0.2in}!
pwrite(fd=10, offset=1024, size=1024)
!{\fontfamily{Times}\selectfont Micro-operations:!
!{\fontfamily{Times}\selectfont \#3 write\_block(inode=12, offset=1024, size=512)}! 
!{\fontfamily{Times}\selectfont \#4 write\_block(inode=12, offset=1536, size=512)}! 
!{\fontfamily{Times}\selectfont Dependencies: \#1, \#2!

!\vspace{-0.2in}!
link(oldpath="/x2VC", newpath="/file")
!{\fontfamily{Times}\selectfont Micro-operations:!
!{\fontfamily{Times}\selectfont \#5 create\_dir\_entry(dirinode=2, entry=``file", inode=12)! 
!{\fontfamily{Times}\selectfont Dependencies: \#1, \#2!

!\vspace{-0.2in}!
write(fd=1, data="Writes recorded", size=15)
!{\fontfamily{Times}\selectfont Micro-operations:!
!{\fontfamily{Times}\selectfont \#6 stdout("Writes recorded")! 
!{\fontfamily{Times}\selectfont Dependencies: \#1, \#2!

\end{lstlisting}

